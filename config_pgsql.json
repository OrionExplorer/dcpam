{
	"system" : [{
		"enabled" : 1,
		"name" : "OTRS",
		"DB" : {
			"ip" : "172.17.0.199",
			"port" : 5432,
			"driver" : 1,
			"driver_comment" : "Driver types: 1=PostgreSQL, 2=MySQL, 3=MariaDB, 4=ODBC 5=Oracle Database, 6=SQLite",
			"user" : "otrs",
			"db" : "otrs",
			"connection_string" : "dbname=%s host=%s port=%d user=%s password=%s",
			"password" : "MTQ4YzE2N2FmYjA5MzdiOGQyNzk5MzQ0"
		},
		"queries" : [{
			"name" : "GET_ACCOUNTED_TIME",
			"data_types" : [
				"TIME_ACCOUNTING"
			],
			"change_data_capture" : {
				"extract" : {
					"comment#00" : "##################################################################################################",
					"comment#01" : "# Sample config below for inserted records works as \"SELECT id FROM secondary_db WHERE id NOT IN (SELECT id FROM primary_db)\".",
					"comment#02" : "# Another example is \"SELECT id FROM secondary_db WHERE created > SELECT MAX(chaned) FROM primary_db\" for deleted records.",
					"comment#03" : "# In Extract subprocess, only one field name (column) is allowed in \"SELECT ... FROM primary_db\" query.",
					"comment#04" : "# In Extract subprocess, query may finish with 0, 1 or many result rows.",
					"comment#05" : "# The \"%s\" format specifier is used by DCPAM to insert results from primary_db query into secondary_db query SQL.",
					"comment#06" : "# Only SELECT queries are allowed in \"*_sql\" commands.",
					"comment#07" : "##################################################################################################",
					"inserted" : {
						"primary_db" : "dcpam",
						"primary_db_sql" : "SELECT system_worklog_id FROM accounted_time WHERE system = 'OTRS'",
						"secondary_db" : "this",
						"secondary_db_sql" : "SELECT t.id AS system_object_id, ta.id AS system_worklog_id, t.customer_id AS system_customer, ta.create_by AS system_agent_id, ta.time_unit AS system_accounted_time, ta.create_time AS system_created FROM time_accounting ta LEFT JOIN ticket t ON t.id = ta.ticket_id WHERE ta.id NOT IN (%s)"
					},
					"deleted" : {
						"primary_db" : "this",
						"primary_db_sql" : "SELECT id AS system_worklog_id FROM time_accounting",
						"secondary_db" : "dcpam",
						"secondary_db_sql" : "SELECT system_object_id, system_worklog_id, system_customer, system_agent_id, system_accounted_time, system_created, system FROM accounted_time WHERE is_valid = 1 AND system_worklog_id NOT IN (%s)"
					},
					"modified" : {
						"primary_db" : "dcpam",
						"primary_db_sql" : "SELECT MAX(changed) AS changed FROM accounted_time WHERE is_valid = 1 AND SYSTEM = 'OTRS'",
						"secondary_db" : "this",
						"secondary_db_sql" : "SELECT t.id AS system_object_id, ta.id AS system_worklog_id, t.customer_id AS system_customer, ta.create_by AS system_agent_id, ta.time_unit AS system_accounted_time, ta.create_time AS system_created FROM time_accounting ta LEFT JOIN ticket t ON t.id = ta.ticket_id WHERE ta.change_time > '%s'"
					}
				},
				"comment#00" : "##################################################################################################",
				"comment#01" : "# Staging Area configuration - a temporary tables, where extracted data is stored and ready to Transform process.",
				"comment#02" : "# There is no restriction on the query type in \"sql\" commands.",
				"comment#03" : "##################################################################################################",
				"stage" : {
					"inserted" : {
						"sql" : "INSERT INTO stage_accounted_time (system_object_id, system_worklog_id, system_customer, system_agent_id, system_accounted_time, system_created, is_valid, system) VALUES (?, ?, '?', '?', ?, '?', 1, 'OTRS')",
						"extracted_values" : ["system_object_id", "system_worklog_id", "system_customer", "system_agent_id", "system_accounted_time", "system_created"]
					},
					"deleted" : {
						"sql" : "INSERT INTO stage_accounted_time (system_object_id, system_worklog_id, system_customer, system_agent_id, system_accounted_time, system_created, is_valid, system) VALUES (?, ?, '?', '?', ?, '?', 0, 'OTRS')",
						"extracted_values" : ["system_object_id", "system_worklog_id", "system_customer", "system_agent_id", "system_accounted_time", "system_created"]
					},
					"modified" : {
						"sql" : "INSERT INTO stage_accounted_time (system_object_id, system_worklog_id, system_customer, system_agent_id, system_accounted_time, system_created, is_valid, system) VALUES (?, ?, '?', '?', ?, '?', 1, 'OTRS')",
						"extracted_values" : ["system_object_id", "system_worklog_id", "system_customer", "system_agent_id", "system_accounted_time", "system_created"]
					},
					"reset" : "DELETE FROM stage_accounted_time"
				},
				"transform" : {
					"comment#00" : "##################################################################################################",
					"comment#01" : "# Yet to be decided how to handle this.",
					"comment#02" : "##################################################################################################",
					"inserted" : [{
						"column" : "accounted_time",
						"expression" : "%f * 1"
					}],
					"deleted" : [],
					"modified" : [{
						"column" : "accounted_time",
						"expression" : "%f * 1"
					}]
				},
				"load" : {
					"comment#00" : "##################################################################################################",
					"comment#01" : "# Query executed with \"output_data_sql\" is fed by the records fetched with \"input_data_sql\" from Staging Area.",
					"comment#02" : "# These are records extracted and transformed in previous steps.",
					"comment#03" : "# It is possible to decide on which columns are to be loaded or updated.",
					"comment#04" : "# There is no restriction on the query type in \"*_sql\" commands.",
					"comment#05" : "##################################################################################################",
					"inserted" : {
						"input_data_sql" : "SELECT system_object_id, system_worklog_id, system_customer, system_agent_id, system_accounted_time, system_created FROM stage_accounted_time",
						"extracted_values" : ["system_object_id", "system_worklog_id", "system_customer", "system_agent_id", "system_accounted_time", "system_created"],
						"output_data_sql" : "INSERT INTO accounted_time (system_object_id, system_worklog_id, system_customer, system_agent_id, system_accounted_time, system_created, is_valid, system) VALUES (?, ?, '?', '?', ?, '?', 1, 'OTRS')"
					},
					"deleted" : {
						"input_data_sql" : "SELECT system_worklog_id FROM stage_accounted_time",
						"extracted_values" : ["system_worklog_id"],
						"output_data_sql" : "UPDATE accounted_time SET is_valid = 0 WHERE system_worklog_id = '?'"
					},
					"modified" : {
						"input_data_sql" : "SELECT system_object_id, system_worklog_id, system_customer, system_agent_id, system_accounted_time, system_created, is_valid FROM stage_accounted_time",
						"extracted_values" : ["system_object_id", "system_worklog_id", "system_customer", "system_agent_id", "system_accounted_time", "system_created", "is_valid", "system_worklog_id"],
						"output_data_sql" : "UPDATE accounted_time SET system_object_id = ?, system_worklog_id = ?, system_customer = '?', system_agent_id = '?', system_accounted_time = ?, system_created = '?', is_valid = ? WHERE system_worklog_id = ?"
					}
				}
			}
		}]
	}],
	"app" : {
		"name" : "DCPAM",
		"version" : "0.1",
		"DB" : {
			"ip" : "127.0.0.1",
			"port" : 5432,
			"driver" : 1,
			"driver_comment" : "Driver types: 1=PostgreSQL, 2=MySQL, 3=MariaDB, 4=ODBC 5=Oracle Database, 6=SQLite",
			"connection_string" : "dbname=%s host=%s port=%d user=%s password=%s",
			"user" : "dcpam",
			"password" : "tantive-4",
			"db" : "dcpam"
		},
		"DATA" : [{
			"id" : "TIME_ACCOUNTING",
			"name" : "Accounted time data",
			"db_table_name" : "accounted_time",
			"columns" : ["system_object_id", "system_worklog_id", "system_customer", "system_agent_id", "accounted_time", "created", "system", "is_valid"],
			"description" : "All accounted time data",
			"actions" : [{
				"name" : "GET_DATA",
				"description" : "Get all data",
				"type" : 1,
				"internal" : false,
				"condition" : "",
				"sql" : "SELECT customer, accounted_time, created, system FROM accounted_time WHERE is_valid = 1"
			}, {
				"name" : "GET_SYSTEM_DATA",
				"description" : "Get all data by system",
				"type" : 1,
				"internal" : false,
				"condition" : "system",
				"sql" : "SELECT customer, accounted_time, created, system FROM accounted_time WHERE system = '%s' AND is_valid = 1"
			}, {
				"name" : "GET_CUSTOMER_DATA",
				"description" : "Get all data by customer",
				"type" : 1,
				"internal" : false,
				"condition" : "system_customer",
				"sql" : "SELECT customer, accounted_time, created, system FROM accounted_time WHERE customer = '%s' AND is_valid = 1"
			}]
		}]
	}
}